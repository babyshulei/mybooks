# 正向代理与反向代理

> 2019.12.03 @wsl

## 概念

### 正向代理

正向代理是一个位于客户端和目标服务器之间的代理服务器(中间服务器)。**为了从原始服务器取得内容，客户端向代理服务器发送一个请求，并且指定目标服务器，之后代理向目标服务器转交并且将获得的内容返回给客户端。**正向代理的情况下客户端必须要进行一些特别的设置才能使用。

使用正向代理服务器作用主要有以下几点：

- 访问本来无法访问的服务器B（翻墙）
- 加速访问服务器B
- Cache作用
- 客户端访问授权
- 隐藏访问者行踪
              

### 反向代理

反向代理正好相反。**对于客户端来说，反向代理就好像目标服务器。**并且客户端不需要进行任何设置。客户端向反向代理发送请求，接着反向代理判断请求走向何处，并将请求转交给客户端，使得这些内容就好似他自己一样，客户端并不会感知到反向代理后面的服务，也因此不需要客户端做任何设置，只需要把反向代理服务器当成真正的服务器就好了。

作用：

- 保护和隐藏原始资源服务器
- 加密和SSL加速
- 负载均衡
- 缓存静态内容
- 压缩
- 减速上传
- 安全
- 外网发布



Nginx在做反向代理时，提供性能稳定，并且能够提供配置灵活的**转发**功能。Nginx可以根据不同的正则匹配，采取不同的转发策略，比如图片文件结尾的走文件服务器，动态页面走web服务器，只要你正则写的没问题，又有相对应的服务器解决方案，你就可以随心所欲的玩。并且Nginx对返回结果进行错误页跳转，异常判断等。如果被分发的服务器存在异常，他可以将请求重新转发给另外一台服务器，然后自动去除异常服务器。



## 区别

正向代理需要你主动设置代理服务器ip或者域名进行访问，由设置的服务器ip或者域名去获取访问内容并返回；而反向代理不需要你做任何设置，直接访问服务器真实ip或者域名，但是服务器内部会自动根据访问内容进行跳转及内容返回，你不知道它最终访问的是哪些机器。

正向代理是代理客户端，为客户端收发请求，使真实客户端对服务器不可见；而反向代理是代理服务器端，为服务器收发请求，使真实服务器对客户端不可见。

![img](..\images\proxy-01.jpg)



## 例子

### 正向代理

X：用户计算机，或计算机上的客户端。

Y：代理网站

Z：用户想要访问的网站

通常，网络连接是直接 X -> Z。然而，某些场景下，需要 Y 代表 X，去访问Z，连接变为 X -> Y -> Z。

**需要正向代理可能的原因：**

X不能访问Z可能是因为：

1）对X的互联网连接具有管理权限的人已决定禁止对站点Z的所有访问。

- 某网站有病毒，为了防止用户中病毒，系统管理员禁止了该网站的访问。
- 为了防止员工工作时在社交网络花费过长时间，禁止员工访问社交网络。
- 学校禁止学生访问游戏网站。
- 政府无法控制新闻的发布，改为屏蔽网站。

2）Z的管理员已禁止X的访问。

- Z发现X在攻击网站，于是禁止了X的IP的访问。
- Z是个论坛，X发布了垃圾邮件，Z就禁止了X的访问。



### 反向代理

X：用户计算机，或计算机上的客户端。

Y：代理网站

Z：用户想要访问的网站

通常，网络连接是直接 X -> Z。然而，某些情况下，Z网站限制or不允许直接访问，必须先访问Y。因此，X通过Y -> Z 获取数据，连接变为 X -> Y -> Z。

与正向代理不同的是，用户X不知道访问的是Z，因为X只能看到他在和Y通信。服务器Z对于客户端是不可见的，只有代理Y是外部可见的。反向代理不需要在客户端进行任何代理配置。

客户端X认为他仅与Y在通信，但实际上是Y转发所有的通信，链路为 X -> Y -> Z。

**需要反向代理可能的原因：**

1）Z 强制到其网站的所有流量首先通过Y。

- Z是一个大型的网站，但是单个Web服务器无法处理所有流量。因此，Z设置了许多服务器，并在互联网上放置了一个反向代理，当用户尝试访问Z时，会将它们发送到距离他们最近的服务器。这是内容分发网络（CDN）概念工作方式的一部分。

2）Z的管理员担心会对服务器上托管的内容进行报复，因此不希望直接向公众公开主服务器。

- 垃圾邮件的所有者似乎拥有数千台服务器，而实际上，大多数网站的服务器数量要少得多。此外，关于垃圾邮件的滥用投诉只会关闭公共服务器，而不是主服务器。



## 参考链接

[What's the difference between a proxy server and a reverse proxy server?](https://stackoverflow.com/questions/224664/whats-the-difference-between-a-proxy-server-and-a-reverse-proxy-server)

[正向代理与反向代理【总结】](https://www.cnblogs.com/Anker/p/6056540.html)

[简书|正向代理与反向代理的区别](https://www.jianshu.com/p/208c02c9dd1d)

[反向代理-中文维基百科](https://zh.wikipedia.org/wiki/反向代理)